<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>護理師系統｜電子白板</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --wb-gap: 12px;
      --wb-border: #d9d9d9;
      --wb-bg: #f6f7f9;
      --wb-card: #ffffff;
    }
    body{ background: var(--wb-bg); }

    /* 主容器：非全螢幕可滾動避免擠壓 */
    #boardRoot{
      max-height: calc(100vh - 86px);
      overflow: auto;
      padding: 12px 12px 18px;
    }
    /* 全螢幕：仍可滾動，但隱藏捲軸（kiosk 感） */
    #boardRoot:fullscreen{
      max-height: none;
      background: var(--wb-bg);
      overflow: auto;
      padding: 16px;
    }
    #boardRoot:fullscreen::-webkit-scrollbar{ width: 0; height: 0; }
    #boardRoot:fullscreen{ scrollbar-width: none; }

    .toolbar{
      position: sticky;
      top: 0;
      z-index: 20;
      background: #fff;
      border-bottom: 1px solid var(--wb-border);
      padding: 10px 12px;
    }
    .toolbar .hint{ color:#6c757d; font-size: 12px; }
    .toolbar .btn{ white-space: nowrap; }

    .wb-grid{
      display: grid;
      grid-template-rows: 3fr 1fr;
      gap: var(--wb-gap);
      min-height: 860px;
    }

    .panel{
      background: var(--wb-card);
      border: 1px solid var(--wb-border);
      border-radius: 14px;
      padding: 10px;
      min-height: 0;
    }
    .panel-title{
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .panel-title small{ font-weight: 500; color:#6c757d; }

    /* 上半：左 3/4 + 右 1/4 */
    .upper{
      display: grid;
      grid-template-columns: 3fr 1fr;
      gap: var(--wb-gap);
      min-height: 0;
    }
    .upper-left{
      display: grid;
      grid-template-rows: auto 1fr;
      gap: var(--wb-gap);
      min-height: 0;
    }
    .info-strip{
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: var(--wb-gap);
      align-items: stretch;
    }
    .info-box{
      border: 1px solid var(--wb-border);
      border-radius: 14px;
      padding: 10px 12px;
      background: #fff;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: start;
    }
    .info-box .left{
      display: grid;
      gap: 6px;
      font-weight: 700;
    }
    .info-box .wx{
      display:flex;
      gap: 8px;
      align-items:center;
      font-weight: 700;
    }
    .info-box .wx span{ font-weight: 700; }
    .info-box .temp{
      font-size: 18px;
      font-weight: 800;
      align-self: start;
      padding-top: 2px;
    }

    .shift-grid{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--wb-gap);
      min-height: 0;
    }
    textarea.wb-text{
      width: 100%;
      resize: none;
      min-height: 0;
      height: 100%;
      font-size: 24px !important;  /* 早/午預設大字 */
      line-height: 1.6 !important;
    }
    #notesText{
      font-size: 22px !important;
      line-height: 1.6 !important;
    }

    /* 下半：0.5/3, 2/3, 0.5/3 */
    .lower{
      display: grid;
      grid-template-columns: 0.5fr 2fr 0.5fr;
      gap: var(--wb-gap);
      min-height: 0;
    }

    /* Pills */
    .pill-list{
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-content: flex-start;
      max-height: 220px;
      overflow: auto;
      padding-right: 4px;
    }
    .pill{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #cfe0ff;
      background: #eef4ff;
      font-size: 13px;
      max-width: 100%;
    }
    .pill .x{
      display: inline-flex;
      width: 18px;
      height: 18px;
      align-items:center;
      justify-content:center;
      border-radius: 999px;
      background: #dbe7ff;
      cursor: pointer;
      user-select:none;
      flex: 0 0 auto;
    }
    .pill .t{
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 520px;
    }

    /* 探視 */
    .visit-grid{ display:flex; flex-direction:column; gap:10px; min-height:0; }
    .visit-row{
      display: grid;
      grid-template-columns: 86px 1fr;
      gap: 10px;
      align-items: stretch;
    }
    .visit-time{
      border: 1px solid var(--wb-border);
      border-radius: 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 800;
      background:#fff;
    }
    .visit-row textarea{
      font-size: 18px !important;
      height: 62px;
    }

    .footnote{
      color:#6c757d;
      font-size: 12px;
      padding: 0 12px 10px;
    }

    /* 只讀模式（全螢幕） */
    #boardRoot.readonly [data-edit="1"]{ display:none !important; }
    #boardRoot.readonly textarea,
    #boardRoot.readonly input,
    #boardRoot.readonly select,
    #boardRoot.readonly button.editable{
      pointer-events: none;
    }
    #boardRoot.readonly textarea,
    #boardRoot.readonly input,
    #boardRoot.readonly select{
      background: #f8f9fa;
    }
    #boardRoot.readonly .pill .x{ display:none !important; }

    /* RWD */
    @media (max-width: 992px){
      .upper{ grid-template-columns: 1fr; }
      .info-strip{ grid-template-columns: 1fr; }
      .shift-grid{ grid-template-columns: 1fr; }
      .lower{ grid-template-columns: 1fr; }
      textarea.wb-text{ font-size: 22px !important; }
      #notesText{ font-size: 20px !important; }
    }
  </style>
</head>

<body>

  <div class="toolbar d-flex flex-wrap gap-2 align-items-center">
    <div class="d-flex align-items-center gap-2">
      <label class="fw-bold">日期</label>
      <input type="date" id="boardDate" class="form-control form-control-sm" style="width: 160px;" data-edit="1">
      <button class="btn btn-outline-secondary btn-sm" id="btnToday" data-edit="1" type="button">今天</button>
    </div>

    <div class="ms-auto d-flex gap-2 align-items-center">
      <button class="btn btn-outline-secondary btn-sm" id="btnLowerSettings" data-edit="1" type="button">下半設定</button>
      <button class="btn btn-primary btn-sm" id="btnSave" data-edit="1" type="button">儲存</button>
      <button class="btn btn-outline-dark btn-sm" id="btnFullscreen" type="button">全螢幕</button>
    </div>

    <div class="w-100 d-flex justify-content-between align-items-center">
      <div class="hint" id="saveHint">—</div>
      <div class="hint">全螢幕：只讀（不能修改）；姓名會自動遮罩，至少中間 1 個字以「0」代替。</div>
    </div>
  </div>

  <div id="boardRoot">
    <div class="wb-grid">
      <!-- 上半 -->
      <div class="upper">
        <!-- 上半左 -->
        <div class="panel upper-left">
          <div class="info-strip">
            <div class="info-box">
              <div class="left">
                <div id="wbDateText">—</div>
                <div id="wbTimeText">—</div>
                <div class="wx"><span id="wbWxEmoji">⛅</span><span id="wbWxText">天氣</span></div>
              </div>
              <div class="temp" id="wbTemp">—</div>
            </div>

            <div class="d-flex align-items-center">
              <div class="text-muted small">
                天氣/溫度：自動抓崁頂鄉北勢村中正路附近（每 10 分鐘更新）
              </div>
            </div>
          </div>

          <div class="shift-grid">
            <div class="panel">
              <div class="panel-title">早 <small>可打字</small></div>
              <textarea class="form-control wb-text" id="morningText" data-edit="1"></textarea>
            </div>
            <div class="panel">
              <div class="panel-title">午 <small>可打字</small></div>
              <textarea class="form-control wb-text" id="noonText" data-edit="1"></textarea>
            </div>
          </div>
        </div>

        <!-- 上半右：備註 -->
        <div class="panel">
          <div class="panel-title">備註 <small>可打字</small></div>
          <textarea class="form-control wb-text" id="notesText" data-edit="1"></textarea>
        </div>
      </div>

      <!-- 下半 -->
      <div class="lower">
        <!-- 1st col -->
        <div class="panel">
          <div class="panel-title">預入住 <small>可多筆</small></div>
          <div class="pill-list" id="preList"></div>
          <hr>
          <div class="panel-title">今日待轉床 <small>可多筆</small></div>
          <div class="pill-list" id="moveList"></div>
          <div class="text-muted small mt-2">顯示格式：床號 姓名(遮罩) ⮕ 目標床</div>
        </div>

        <!-- 2nd col -->
        <div class="panel">
          <div class="panel-title">
            <span>家屬探視 <small>由 bookings 帶入 / 可手改</small></span>
            <button class="btn btn-outline-secondary btn-sm" id="btnAutoVisits" data-edit="1" type="button">自動帶入 bookings</button>
          </div>

          <div class="visit-grid">
            <div class="visit-row">
              <div class="visit-time">14:30</div>
              <textarea class="form-control wb-text" id="visit1430" rows="2" data-edit="1"></textarea>
            </div>
            <div class="visit-row">
              <div class="visit-time">15:00</div>
              <textarea class="form-control wb-text" id="visit1500" rows="2" data-edit="1"></textarea>
            </div>
            <div class="visit-row">
              <div class="visit-time">15:30</div>
              <textarea class="form-control wb-text" id="visit1530" rows="2" data-edit="1"></textarea>
            </div>
            <div class="visit-row">
              <div class="visit-time">16:00</div>
              <textarea class="form-control wb-text" id="visit1600" rows="2" data-edit="1"></textarea>
            </div>
            <div class="visit-row">
              <div class="visit-time">16:30</div>
              <textarea class="form-control wb-text" id="visit1630" rows="2" data-edit="1"></textarea>
            </div>
          </div>
        </div>

        <!-- 3rd col -->
        <div class="panel">
          <div class="panel-title">預解隔 <small>可多筆</small></div>
          <div class="pill-list" id="isoList"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="footnote">
    提示：全螢幕只讀；姓名遮罩至少中間 1 個字為「0」。
  </div>

  <!-- 下半設定 Modal -->
  <div class="modal fade" id="lowerSettingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">下半設定</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="tab-pre" data-bs-toggle="tab" data-bs-target="#pane-pre" type="button" role="tab">預入住</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="tab-move" data-bs-toggle="tab" data-bs-target="#pane-move" type="button" role="tab">今日待轉床</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="tab-iso" data-bs-toggle="tab" data-bs-target="#pane-iso" type="button" role="tab">預解隔</button>
            </li>
          </ul>

          <div class="tab-content pt-3">
            <!-- Pre -->
            <div class="tab-pane fade show active" id="pane-pre" role="tabpanel">
              <div class="row g-2 align-items-end">
                <div class="col-md-3">
                  <label class="form-label small">日期</label>
                  <input type="date" id="preDate" class="form-control" data-edit="1">
                </div>
                <div class="col-md-3">
                  <label class="form-label small">床號</label>
                  <input id="preBed" class="form-control" placeholder="例：216-1" data-edit="1">
                </div>
                <div class="col-md-4">
                  <label class="form-label small">姓名</label>
                  <input id="preName" class="form-control" placeholder="姓名" data-edit="1">
                </div>
                <div class="col-md-2 d-grid">
                  <button class="btn btn-success" id="btnAddPre" data-edit="1" type="button">新增</button>
                </div>
              </div>
              <hr>
              <div class="pill-list" id="preListModal"></div>
            </div>

            <!-- Move -->
            <div class="tab-pane fade" id="pane-move" role="tabpanel">
              <div class="row g-2 align-items-end">
                <div class="col-md-3">
                  <label class="form-label small">原床</label>
                  <input id="fromBed" class="form-control" placeholder="例：216-1" data-edit="1">
                </div>
                <div class="col-md-3">
                  <label class="form-label small">目標床</label>
                  <input id="toBed" class="form-control" placeholder="例：216-2" data-edit="1">
                </div>
                <div class="col-md-4">
                  <label class="form-label small">住民（依原床帶出）</label>
                  <select id="residentByBed" class="form-select" data-edit="1">
                    <option value="">先輸入原床</option>
                  </select>
                  <div class="text-muted small mt-1">顯示會自動遮罩</div>
                </div>
                <div class="col-md-2 d-grid">
                  <button class="btn btn-success" id="btnAddMove" data-edit="1" type="button">新增</button>
                </div>
              </div>
              <hr>
              <div class="pill-list" id="moveListModal"></div>
            </div>

            <!-- Iso -->
            <div class="tab-pane fade" id="pane-iso" role="tabpanel">
              <div class="row g-2 align-items-end">
                <div class="col-md-3">
                  <label class="form-label small">日期</label>
                  <input type="date" id="isoDate" class="form-control" data-edit="1">
                </div>
                <div class="col-md-3">
                  <label class="form-label small">床號</label>
                  <input id="isoBed" class="form-control" placeholder="例：113" data-edit="1">
                </div>
                <div class="col-md-3">
                  <label class="form-label small">預到床</label>
                  <input id="isoToBed" class="form-control" placeholder="例：216-1" data-edit="1">
                </div>
                <div class="col-md-3">
                  <label class="form-label small">姓名</label>
                  <input id="isoName" class="form-control" placeholder="姓名" data-edit="1">
                </div>
                <div class="col-12 d-grid mt-2">
                  <button class="btn btn-success" id="btnAddIso" data-edit="1" type="button">新增</button>
                </div>
              </div>
              <hr>
              <div class="pill-list" id="isoListModal"></div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="text-muted small me-auto">刪除：在小方框按 ×（全螢幕只讀無法操作）</div>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase（你原本頁面通常已經有 firebase-init.js，這裡保持相容：等 firebase-ready 事件） -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- 本頁 JS -->
  <script src="nurse-whiteboard.js"></script>
</body>
</html>
