const translations = {
    'zh-TW': {
        // --- ÈÄöÁî® ---
        'lang_switch': 'English',
        'back_to_dashboard': 'ËøîÂõûÂÑÄË°®Êùø',
        'back_to_main_menu': 'ËøîÂõûÈ¶ñÈ†ÅÈÅ∏ÂñÆ',
        'back_to_caregiver_system': 'ËøîÂõûÁÖßÊúçÂì°Á≥ªÁµ±',
        'back_to_office_system': 'ËøîÂõûËæ¶ÂÖ¨ÂÆ§Á≥ªÁµ±',
        'save': 'ÂÑ≤Â≠ò',
        'confirm': 'Á¢∫Ë™ç',
        'cancel': 'ÂèñÊ∂à',
        'error_enter_name_first': 'Ë´ãÂÖàËº∏ÂÖ•ÊÇ®ÁöÑÂßìÂêçÔºÅ',
        'loading': 'ËÆÄÂèñ‰∏≠...',
        'confirm_submission': 'Á¢∫Ë™çÈÄÅÂá∫',
        'return_to_modify': 'ËøîÂõû‰øÆÊîπ',
        'admin_settings': 'ÁÆ°ÁêÜÂì°Ë®≠ÂÆö',
        'please_enter_password': 'Ë´ãËº∏ÂÖ•ÂØÜÁ¢º',
        'login': 'ÁôªÂÖ•',
        'password_error': 'ÂØÜÁ¢ºÈåØË™§ÔºåË´ãÈáçË©¶ÔºÅ',
        'back_to_home': 'ËøîÂõûÈ¶ñÈ†Å',
        'querying': 'Êü•Ë©¢‰∏≠...',
        'no_records_found': 'Êü•ÁÑ°Áõ∏ÈóúÈ†êÁ¥ÑÁ¥ÄÈåÑ„ÄÇ',
        'query_failed': 'Êü•Ë©¢Â§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ',
        'confirm_cancel_booking': 'ÊÇ®Á¢∫ÂÆöË¶ÅÂèñÊ∂àÈÄôÂÄãÈ†êÁ¥ÑÂóéÔºü',
        'booking_cancelled_success': 'È†êÁ¥ÑÂ∑≤ÊàêÂäüÂèñÊ∂àÔºÅ',
        'delete_failed': 'Âà™Èô§Â§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ',
        'please_enter_phone': 'Ë´ãËº∏ÂÖ•ÈõªË©±ËôüÁ¢ºÔºÅ',
        'start_query': 'ÈñãÂßãÊü•Ë©¢',
        'read_failed': 'ËÆÄÂèñÂ§±Êïó',
        'status_ongoing': 'ÈÄ≤Ë°å‰∏≠',
        'status_closed': 'Â∑≤ÁµêÊ°à',
        'not_set': 'Êú™Ë®≠ÂÆö',
        'read_list_failed': 'ËÆÄÂèñÂàóË°®Â§±Êïó„ÄÇ',
        'save_failed': 'ÂÑ≤Â≠òÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ',

        // --- ‰∏ªÈÅ∏ÂñÆ ---
        'main_title_full': 'ÂÆâÊ≥∞ÈÜ´ÁôÇÁ§æÂúòÊ≥ï‰∫∫ÈôÑË®≠ÂÆâÊ≥∞Ë≠∑ÁêÜ‰πãÂÆ∂',
        'main_menu_title': 'ÊúçÂãôÈÅ∏ÂñÆ',
        'booking_visit': 'È†êÁ¥ÑÊé¢Ë¶ñ',
        'query_cancel_booking': 'Êü•Ë©¢/ÂèñÊ∂àÈ†êÁ¥Ñ',
        'hospital_booking': 'ÂÆâÊ≥∞ÈÜ´Èô¢ÈñÄË®∫ÊéõËôü',
        'hospital_query': 'ÂÆâÊ≥∞ÈÜ´Èô¢ÊéõËôüÊü•Ë©¢',
        'visit_rules': 'Êé¢Ë¶ñË¶èÁØÑ',
        'contact_us': 'ËÅØÁµ°ÊàëÂÄë',
        'nurse_login': 'Ë≠∑ÁêÜÂ∏´ÁôªÂÖ•',
        'caregiver_login': 'ÁÖßÊúçÂì°ÁôªÂÖ•',
        'office_login': 'Ëæ¶ÂÖ¨ÂÆ§ÁôªÂÖ•',
        
        // --- È†êÁ¥ÑÁ≥ªÁµ± ---
        'booking_system_title': 'È†êÁ¥ÑÊé¢Ë¶ñÁ≥ªÁµ±',
        'admin_mode_notice': 'ÁÆ°ÁêÜÂì°Ê®°ÂºèÔºöÊÇ®ÁèæÂú®ÂèØ‰ª•È†êÁ¥Ñ‰ªäÂ§©Â∑≤ÈÅé‰∏≠ÂçàÁöÑÊôÇÊÆµ„ÄÇ',
        'step1_title': 'Ê≠•È©ü‰∏ÄÔºöÈÅ∏ÊìáÊé¢Ë¶ñÊó•ÊúüËàáÊôÇÊÆµ',
        'choose_date': 'ÈÅ∏ÊìáÊó•Êúü',
        'today_past_noon': '‰ªäÊó•Â∑≤ÈÅé‰∏≠Âçà12ÈªûÔºåÁÑ°Ê≥ïÈ†êÁ¥ÑÁï∂Â§©ÊôÇÊÆµÔºåË´ãÈÅ∏ÊìáÂÖ∂‰ªñÊó•Êúü„ÄÇ',
        'reading_slots': 'ËÆÄÂèñ‰∏≠...',
        'read_slots_failed': 'ËÆÄÂèñÊôÇÊÆµÂ§±ÊïóÔºåË´ãÈáçÊñ∞Êï¥ÁêÜÈ†ÅÈù¢„ÄÇ',
        'slot_full': 'Â∑≤È°çÊªø',
        'slot_past': 'Â∑≤ÈÄæÊôÇ',
        'slot_remaining': 'Ââ©È§ò {remaining} ÁµÑ',
        'step2_title': 'Ê≠•È©ü‰∫åÔºöÂ°´ÂØ´È†êÁ¥ÑË≥áÊñô',
        'resident_name': '‰ΩèÊ∞ëÂßìÂêç',
        'bed_number': 'Â∫äËôü',
        'visitor_name': 'ÂÆ∂Â±¨ÂßìÂêç',
        'visitor_relationship': 'Ëàá‰ΩèÊ∞ëÈóú‰øÇ',
        'contact_phone': 'ËÅØÁµ°ÈõªË©±',
        'confirm_booking': 'Á¢∫Ë™çÈ†êÁ¥Ñ',
        'back_to_time_select': 'ËøîÂõûÈÅ∏ÊìáÊôÇÊÆµ',
        'booking_success_title': '‚úî È†êÁ¥ÑÊàêÂäüÔºÅ',
        'booking_success_info': 'ÊÑüË¨ùÊÇ®ÁöÑÈ†êÁ¥ÑÔºå‰ª•‰∏ãÊòØÊÇ®ÁöÑÈ†êÁ¥ÑË≥áË®äÔºö',
        'date': 'Êó•Êúü',
        'time': 'ÊôÇÈñì',
        'important_notice': 'ÈáçË¶ÅÊèêÈÜíÔºöÊú™‰æÜËã•ÈúÄÊü•Ë©¢ÊàñÂèñÊ∂àÈ†êÁ¥ÑÔºåË´ã‰ΩøÁî®ÊÇ®ÁöÑ„ÄåÈõªË©±ËôüÁ¢º„Äç‰ΩúÁÇ∫ÊÜëË≠â„ÄÇ',
        'error_resident_name_invalid': '‰ΩèÊ∞ëÂßìÂêç‰∏çÊ≠£Á¢∫ÔºåÁÑ°Ê≥ïÊèê‰∫§È†êÁ¥ÑÔºÅ',
        'name_validation_success': 'ÂßìÂêçÈ©óË≠âÊàêÂäüÔºÅ',
        'name_validation_fail': 'Êü•ÁÑ°Ê≠§‰ΩèÊ∞ëÂßìÂêçÔºåË´ãÁ¢∫Ë™çËº∏ÂÖ•ÊòØÂê¶Ê≠£Á¢∫„ÄÇ',
        'booking_failed': 'È†êÁ¥ÑÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ',
        'enter_phone_to_query': 'Ë´ãËº∏ÂÖ•ÊÇ®È†êÁ¥ÑÊôÇ‰ΩøÁî®ÁöÑÈõªË©±ËôüÁ¢ºÔºö',
        'please_fill_resident_name': 'Ë´ãÂ°´ÂØ´‰ΩèÊ∞ëÂßìÂêç„ÄÇ',
        'please_fill_visitor_name': 'Ë´ãÂ°´ÂØ´ÊÇ®ÁöÑÂßìÂêç„ÄÇ',
        'please_fill_visitor_relationship': 'Ë´ãÂ°´ÂØ´ÊÇ®Ëàá‰ΩèÊ∞ëÁöÑÈóú‰øÇ„ÄÇ',
        'please_fill_contact_phone': 'Ë´ãÂ°´ÂØ´ÊÇ®ÁöÑËÅØÁµ°ÈõªË©±„ÄÇ',
        'confirm_booking_info_title': 'Ë´ãÁ¢∫Ë™çÊÇ®ÁöÑÈ†êÁ¥ÑË≥áË®ä',

        // --- Âì°Â∑•Á≥ªÁµ± (ÈÄöÁî®) ---
        'nurse_system': 'Ë≠∑ÁêÜÂ∏´Á≥ªÁµ±',
        'enter_nurse_password': 'Ë´ãËº∏ÂÖ•Ë≠∑ÁêÜÂ∏´ÂØÜÁ¢º',
        'booking_list_query': 'È†êÁ¥ÑÂêçÂñÆÊü•Ë©¢',
        'proxy_booking': '‰ª£ÂÆ¢È†êÁ¥Ñ',
        'supplies_inventory': 'Ë°õÊùêÈªûÁè≠',
        'leave_system': 'È†êÂÅáÁ≥ªÁµ±',
        'all_booking_records': 'ÊâÄÊúâÈ†êÁ¥ÑÁ¥ÄÈåÑ',
        'resident_data_management': '‰ΩèÊ∞ëË≥áÊñôÁÆ°ÁêÜ',
        'employee_data_management': 'Âì°Â∑•Ë≥áÊñôÁÆ°ÁêÜ',
        'temperature_log': 'È´îÊ∫´ÁôªÈåÑ',
        'save_today_temps': 'ÂÑ≤Â≠ò‰ªäÊó•È´îÊ∫´',
        'caregiver_system': 'ÁÖßÊúçÂì°Á≥ªÁµ±',
        'enter_caregiver_password': 'Ë´ãËº∏ÂÖ•ÁÖßÊúçÂì°ÂØÜÁ¢º',
        'temperature_log_caregiver': 'ÁÖßÊúçÂì°È´îÊ∫´ÁôªÈåÑ',
        'caregiver_temperature_log_title': 'ÁÖßÊúçÂì°ÊØèÊó•È´îÊ∫´ÁôªÈåÑ',
        'temperature_log_nurse': 'Ë≠∑ÁêÜÂ∏´È´îÊ∫´ÁôªÈåÑ',
        'nurse_temperature_log_title': 'Ë≠∑ÁêÜÂ∏´ÊØèÊó•È´îÊ∫´ÁôªÈåÑ',
        'caregiver_leave_system_menu': 'È†êÂÅáÁ≥ªÁµ±',
        'login_network_error': 'ÁôªÂÖ•ÊôÇÁôºÁîüÁ∂≤Ë∑ØÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ',
        'foley_care_assessment_menu': 'Â∞éÂ∞øÁÆ°ÁÖßË≠∑Ë©ï‰º∞',
        'temperature_record_menu': 'È´îÊ∫´ÁôªÈåÑ',
        'caregiver_leave_system': 'ÁÖßÊúçÂì° È†êÂÅá/È†êÁè≠Á≥ªÁµ±',

        // --- È†êÂÅá/È†êÁè≠Á≥ªÁµ± ---
        'your_name': 'ÊÇ®ÁöÑÂßìÂêç',
        'enter_your_name_to_book': 'Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÂßìÂêç‰ª•È†êÊéí',
        'calendar_title_prefix': 'Âπ¥',
        'calendar_title_suffix': 'Êúà',
        'leave_period_open': 'È†êÂÅá/È†êÁè≠ÈñãÊîæ‰∏≠ÔºÅÊúüÈñìÔºö',
        'leave_period_closed': 'ÁõÆÂâçÈùûÈ†êÂÅá/È†êÁè≠ÈñãÊîæÊúüÈñì„ÄÇ‰∏ãÊ¨°ÈñãÊîæÔºö',
        'leave_period_open': 'È†êÂÅá/È†êÁè≠ÈñãÊîæ‰∏≠ÔºÅÊúüÈñìÔºö',
        'week_sun': 'Êó•', 'week_mon': '‰∏Ä', 'week_tue': '‰∫å', 'week_wed': '‰∏â', 'week_thu': 'Âõõ', 'week_fri': '‰∫î', 'week_sat': 'ÂÖ≠',
        'next_month_overview': '‰∏ãÂÄãÊúàÈ†êÂÅá/È†êÁè≠Á∏ΩË¶Ω',
        'export_word': 'ÂåØÂá∫ Word',
        'export_excel': 'ÂåØÂá∫ Excel',
        'print_report': 'ÂàóÂç∞Â†±Ë°®',
        'employee_id': 'Âì°Á∑®',
        'admin_verification': 'ÁÆ°ÁêÜÂì°È©óË≠â',
        'enter_admin_password_for_settings': 'Ë´ãËº∏ÂÖ•ÁÆ°ÁêÜÂì°ÂØÜÁ¢º‰ª•Ë®≠ÂÆöÈ†êÂÅáÊúüÈñì„ÄÇ',
        'set_next_month_leave_period': 'Ë®≠ÂÆö‰∏ãÂÄãÊúàÁöÑÈ†êÂÅá/È†êÁè≠ÈñãÊîæÊúüÈñì',
        'start_date': 'ÈñãÂßãÊó•ÊúüËàáÊôÇÈñì',
        'end_date': 'ÁµêÊùüÊó•ÊúüËàáÊôÇÈñì',
        'verification_failed': 'È©óË≠âÊôÇÁôºÁîüÁ∂≤Ë∑ØÈåØË™§ÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Á∑öÊàñÁ®çÂæåÂÜçË©¶„ÄÇ',
        'set_start_end_date': 'Ë´ãË®≠ÂÆöÈñãÂßãËàáÁµêÊùüÊó•Êúü',
        'end_date_cannot_be_earlier': 'ÁµêÊùüÊó•Êúü‰∏çÂèØÊó©ÊñºÈñãÂßãÊó•Êúü',
        'settings_saved': 'È†êÂÅáÊúüÈñìÂ∑≤ÂÑ≤Â≠òÔºÅÈ†ÅÈù¢Â∞áÊúÉÈáçÊñ∞ËºâÂÖ•‰ª•Â•óÁî®Êñ∞Ë®≠ÂÆö„ÄÇ',
        'settings_save_failed': 'ÂÑ≤Â≠òË®≠ÂÆöÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ',
        'read_calendar_failed': 'ËÆÄÂèñÊó•ÊõÜÂ§±ÊïóÔºåË´ãÈáçÊñ∞Êï¥ÁêÜ„ÄÇ',
        'select_shift_for': 'ÈÅ∏Êìá {date} ÁöÑÁè≠Âà•',
        'clear_this_day': 'Ê∏ÖÈô§Ê≠§Êó•',
        'no_leave_requests_next_month': '‰∏ãÂÄãÊúàÂ∞öÁÑ°È†êÂÅá/È†êÁè≠Á¥ÄÈåÑ„ÄÇ',
        'load_summary_failed': 'ËÆÄÂèñÁ∏ΩË¶ΩË≥áÊñôÂ§±Êïó„ÄÇ',
        'shift_d': 'D (ÁôΩÁè≠)', 'shift_n': 'N (Â§ßÂ§ú)', 'shift_off': 'OFF (‰ºëÂÅá)',

        // --- Â∞éÂ∞øÁÆ°ÁÖßË≠∑Ë©ï‰º∞ ---
        'foley_care_assessment': 'Â∞éÂ∞øÁÆ°ÁÖßË≠∑Ë©ï‰º∞Ë°®',
        'foley_care_title': 'ÁÖßË≠∑Ê©üÊßãÈ†êÈò≤Â∞éÂ∞øÁÆ°Áõ∏ÈóúÊ≥åÂ∞øÈÅìÊÑüÊüìÊØèÊó•ÁÖßË≠∑Ë©ï‰º∞Ë°®',
        'please_select_resident': 'Ë´ãÈÅ∏Êìá‰ΩèÊ∞ë',
        'all_residents': 'ÂÖ®ÈÉ®‰ΩèÊ∞ë',
        'please_select_resident_first': 'Ë´ãÂÖàÂæû‰∏äÊñπÈÅ∏Êìá‰∏Ä‰Ωç‰ΩèÊ∞ëÔºÅ',
        'ongoing_care_forms': 'ÈÄ≤Ë°å‰∏≠ÁöÑÁÖßË≠∑ÂñÆ',
        'closed_care_forms': 'Â∑≤ÁµêÊ°àÁöÑÁÖßË≠∑ÂñÆ',
        'add_new_form': 'Êñ∞Â¢ûÁÖßË≠∑ÂñÆ',
        'no_care_forms_found': 'Êâæ‰∏çÂà∞Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑÁÖßË≠∑ÂñÆÁ¥ÄÈåÑ„ÄÇ',
        'resident_basic_info': '‰ΩèÊ∞ëÂü∫Êú¨Ë≥áÊñô',
        'placement_date': 'ÁΩÆÊîæÊó•Êúü',
        'closing_date': 'ÁµêÊ°àÊó•Êúü',
        'care_period': 'ÁÖßË≠∑ÊúüÈñì',
        'ongoing': 'ÊåÅÁ∫å‰∏≠',
        'assessment_items': 'ÊØèÊó•Ë©ï‰º∞È†ÖÁõÆ',
        'signature': 'Á∞ΩÁ´†',
        'caregiver': 'ÁÖßÊúçÂì°',
        'nurse': 'Ë≠∑ÁêÜÂ∏´',
        'hand_hygiene': '1. ÊâãÈÉ®Ë°õÁîü',
        'fixed_position': '2. Âõ∫ÂÆö‰ΩçÁΩÆ',
        'unobstructed_drainage': '3. ÁÑ°ËèåÊö¢ÈÄö',
        'avoid_overfill': '4. ÈÅøÂÖçÈÅéÊªø',
        'urethral_cleaning': '5. Â∞øÈÅìÂè£Ê∏ÖÊΩî',
        'single_use_container': '6. ÂñÆ‰∏ÄÈùûÂÖ±Áî®ÂÆπÂô®',
        'yes': 'Yes',
        'no': 'No',
        'save_this_care_form': 'ÂÑ≤Â≠òÊ≠§ÂºµÁÖßË≠∑ÂñÆ',
        'delete_this_care_form': 'Âà™Èô§Ê≠§ÂºµÁÖßË≠∑ÂñÆ',
        'back_to_list': 'ËøîÂõûÂàóË°®',
        'load_care_form_failed': 'ËºâÂÖ•ÁÖßË≠∑ÂñÆÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ',
        'fill_form_first': 'Ë´ãÂÖàÈÅ∏Êìá‰ΩèÊ∞ë‰∏¶Â°´ÂØ´ÁΩÆÊîæÊó•ÊúüÔºÅ',
        'care_form_saved': 'ÁÖßË≠∑ÂñÆÂ∑≤ÊàêÂäüÂÑ≤Â≠òÔºÅ',
        'confirm_delete_care_form': 'ÊÇ®Á¢∫ÂÆöË¶ÅÊ∞∏‰πÖÂà™Èô§Ê≠§ÂºµÁÖßË≠∑ÂñÆÂóéÔºü\nÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºÅ',
        'care_form_deleted': 'ÁÖßË≠∑ÂñÆÂ∑≤ÊàêÂäüÂà™Èô§ÔºÅ',
        'index_building_warning': 'Á≥ªÁµ±Ê≠£Âú®Âª∫Á´ãÊñ∞ÁöÑË≥áÊñôÂ∫´Á¥¢Âºï‰ª•ÊîØÊè¥Êü•Ë©¢ÔºåË´ãÁ≠âÂæÖÂπæÂàÜÈêòÂæåÂÜçË©¶„ÄÇ',
        
        // --- Ëæ¶ÂÖ¨ÂÆ§Á≥ªÁµ± ---
        'office_system': 'Ëæ¶ÂÖ¨ÂÆ§Á≥ªÁµ±', 'enter_office_password': 'Ë´ãËº∏ÂÖ•Ëæ¶ÂÖ¨ÂÆ§ÂØÜÁ¢º',
        'auto_temp_system': 'Ëá™ÂãïÂåñÈ´îÊ∫´Á¥ÄÈåÑÁ≥ªÁµ±', 'auto_clockin_system': 'Ëá™ÂãïÂåñÊâìÂç°Á¥ÄÈåÑÁ≥ªÁµ±',
        'temperature_system': 'È´îÊ∫´Á≥ªÁµ±','temperature_label': 'È´îÊ∫´','clockin_system': 'ÊâìÂç°Á≥ªÁµ±',
        'select_month': 'ÈÅ∏ÊìáÊúà‰ªΩ', 'upload_schedule': '‰∏äÂÇ≥Áè≠Ë°®',
        'upload_and_generate': '‰∏äÂÇ≥Áè≠Ë°®‰∏¶ÁîüÊàêÁ¥ÄÈåÑ', 'reading_schedule_and_generating': 'Ê≠£Âú®ËÆÄÂèñÁè≠Ë°®‰∏¶ÁîüÊàêÁ¥ÄÈåÑ...',
        'error_select_month_first': 'Ë´ãÂÖàÈÅ∏ÊìáÊúà‰ªΩÔºÅ', 'error_read_excel': 'ËÆÄÂèñ Excel Ê™îÊ°àÂ§±ÊïóÔºåË´ãÁ¢∫Ë™çÊ™îÊ°àÊ†ºÂºèÊòØÂê¶Ê≠£Á¢∫„ÄÇ',
        'export_word': 'ÂåØÂá∫ Word', 'export_excel': 'ÂåØÂá∫ Excel', 'print_report': 'ÂàóÂç∞Â†±Ë°®',
        'no_report_generated': 'Ë´ãÂÖàÈÅ∏ÊìáÊúà‰ªΩ‰∏¶‰∏äÂÇ≥Áï∂Êúà‰ªΩÁöÑ Excel Áè≠Ë°®Ê™îÊ°à„ÄÇ',
        'temp_report_title': 'Âì°Â∑•È´îÊ∫´Á¥ÄÈåÑÁ∏ΩË°®', 'clockin_report_title': 'Âì°Â∑•ÊâìÂç°Á¥ÄÈåÑÁ∏ΩË°®',
        'clock_in': '‰∏äÁè≠', 'clock_out': '‰∏ãÁè≠',

        // ... (ÂÖ∂‰ªñÈùúÊÖãÈ†ÅÈù¢ÁøªË≠Ø‰∏çËÆä) ...
    },
    'en': {
        // --- Common ---
        'lang_switch': 'Chinese', 'back_to_dashboard': 'Back to Dashboard', 'back_to_main_menu': 'Back to Main Menu',
        'back_to_caregiver_system': 'Back to Caregiver System', 'back_to_office_system': 'Back to Office System', 'save': 'Save',
        'confirm': 'Confirm', 'cancel': 'Cancel', 'error_enter_name_first': 'Please enter your name first!', 'loading': 'Loading...',
        'confirm_submission': 'Confirm Submission', 'return_to_modify': 'Return to Modify', 'admin_settings': 'Admin Settings',
        'please_enter_password': 'Please enter password', 'login': 'Login', 'password_error': 'Password incorrect, please try again!',
        'back_to_home': 'Back to Home', 'querying': 'Querying...', 'no_records_found': 'No relevant booking records found.',
        'query_failed': 'Query failed, please try again later.', 'confirm_cancel_booking': 'Are you sure you want to cancel this booking?',
        'booking_cancelled_success': 'Booking has been cancelled successfully!', 'delete_failed': 'Delete failed, please try again later.',
        'please_enter_phone': 'Please enter phone number!', 'start_query': 'Start Query', 'read_failed': 'Read failed',
        'status_ongoing': 'Ongoing', 'status_closed': 'Closed', 'not_set': 'Not set', 'read_list_failed': 'Failed to load list.',
        'save_failed': 'Save failed, please try again later.',

        // --- Main Menu ---
        'main_title_full': 'Antai Medical Corporation Antai Nursing Home', 'main_menu_title': 'Service Menu',
        'booking_visit': 'Visit Booking', 'query_cancel_booking': 'Query/Cancel Booking', 'hospital_booking': 'Hospital Appointment',
        'hospital_query': 'Appointment Query', 'visit_rules': 'Visitation Rules', 'contact_us': 'Contact Us',
        'nurse_login': 'Nurse Login', 'caregiver_login': 'Caregiver Login', 'office_login': 'Office Login',

        // --- Booking System ---
        'booking_system_title': 'Visit Booking System', 'admin_mode_notice': 'Admin Mode: You can now book slots for today after 12:00 PM.',
        'step1_title': 'Step 1: Select Date and Time', 'choose_date': 'Select Date',
        'today_past_noon': 'Booking for today is closed after 12:00 PM. Please select another date.', 'reading_slots': 'Loading...',
        'read_slots_failed': 'Failed to load time slots, please refresh the page.', 'slot_full': 'Full', 'slot_past': 'Past',
        'slot_remaining': 'Remaining: {remaining}', 'step2_title': 'Step 2: Fill in Information', 'resident_name': 'Resident\'s Name',
        'bed_number': 'Bed Number', 'visitor_name': 'Visitor\'s Name', 'visitor_relationship': 'Relationship to Resident',
        'contact_phone': 'Contact Phone', 'confirm_booking': 'Confirm Booking', 'back_to_time_select': 'Back to Time Selection',
        'booking_success_title': '‚úî Booking Successful!', 'booking_success_info': 'Thank you for your booking. Here is your information:',
        'date': 'Date', 'time': 'Time', 'important_notice': 'Important: To query or cancel your booking in the future, please use your phone number.',
        'error_resident_name_invalid': 'Resident name is incorrect, cannot submit booking!', 'name_validation_success': 'Name verification successful!',
        'name_validation_fail': 'Resident name not found, please check your input.', 'booking_failed': 'Booking failed, please try again later.',
        'enter_phone_to_query': 'Please enter the phone number used for the booking:', 'please_fill_resident_name': 'Please fill in resident\'s name.',
        'please_fill_visitor_name': 'Please fill in your name.', 'please_fill_visitor_relationship': 'Please fill in your relationship to the resident.',
        'please_fill_contact_phone': 'Please fill in your contact phone.', 'confirm_booking_info_title': 'Please confirm your booking information',

        // --- Employee Systems (Common) ---
        'nurse_system': 'Nurse System', 'enter_nurse_password': 'Please enter nurse password', 'booking_list_query': 'Booking List Query',
        'proxy_booking': 'Proxy Booking', 'supplies_inventory': 'Supplies Inventory', 'leave_system': 'Leave Request System',
        'all_booking_records': 'All Booking Records', 'resident_data_management': 'Resident Data Management',
        'employee_data_management': 'Employee Data Management', 'temperature_log': 'Temperature Log', 'caregiver_system': 'Caregiver System',
        'enter_caregiver_password': 'Please enter caregiver password', 'caregiver_leave_system_menu': 'Leave Request System','temperature_log_caregiver': 'Caregiver Temperature Log',
        'caregiver_temperature_log_title': 'Daily Temperature Log for Caregivers','temperature_log_nurse': 'Nurse Temperature Log',
        'nurse_temperature_log_title': 'Daily Temperature Log for Nurses',
        'login_network_error': 'A network error occurred during login, please try again later.', 'foley_care_assessment_menu': 'Foley Care Assessment',
        'temperature_record_menu': 'Temperature Recording','caregiver_leave_system': 'Caregiver Leave/Shift System','save_today_temps': 'Save Today\'s Temperatures',

        // --- Leave Request System ---
        'your_name': 'Your Name', 'enter_your_name_to_book': 'Please enter your name to request', 'calendar_title_prefix': '',
        'calendar_title_suffix': '', 'leave_period_open': 'Leave/Shift request period is open! From',
        'leave_period_closed': 'Leave/Shift request period is currently closed. Next period:','leave_period_open': 'Leave scheduling period open! Period:',
        'week_sun': 'Sun', 'week_mon': 'Mon', 'week_tue': 'Tue', 'week_wed': 'Wed', 'week_thu': 'Thu', 'week_fri': 'Fri', 'week_sat': 'Sat',
        'admin_verification': 'Admin Verification', 'enter_admin_password_for_settings': 'Please enter admin password to set the leave/shift request period.',
        'set_next_month_leave_period': 'Set Leave/Shift Request Period for Next Month', 'start_date': 'Start Date & Time', 'end_date': 'End Date & Time',
        'verification_failed': 'A network error occurred during verification, please check your connection or try again later.',
        'set_start_end_date': 'Please set both start and end dates', 'end_date_cannot_be_earlier': 'End date cannot be earlier than start date',
        'settings_saved': 'Leave request period has been saved! The page will now reload to apply the new settings.',
        'settings_save_failed': 'Failed to save settings, please try again later.', 'read_calendar_failed': 'Failed to load calendar data. Please refresh.',
        'select_shift_for': 'Select shift for {date}', 'clear_this_day': 'Clear This Day', 'no_leave_requests_next_month': 'No leave/shift requests for next month yet.',
        'load_summary_failed': 'Failed to load summary data.', 'shift_d': 'D (Day)', 'shift_n': 'N (Night)', 'shift_off': 'OFF',
        'next_month_overview': 'Next Month Leave/Shift Overview',
        'export_word': 'Export Word',
        'export_excel': 'Export Excel',
        'print_report': 'Print Report',
        'employee_id': 'Employee ID',


        // --- Foley Care Assessment ---
        'foley_care_assessment': 'Foley Care Assessment Form', 'foley_care_title': 'Daily Care Assessment Form for Preventing Catheter-Associated Urinary Tract Infections',
        'please_select_resident': 'Please select a resident', 'all_residents': 'All Residents', 'please_select_resident_first': 'Please select a resident from the top menu first!',
        'ongoing_care_forms': 'Ongoing Care Forms', 'closed_care_forms': 'Closed Care Forms', 'add_new_form': 'Add New Care Form',
        'no_care_forms_found': 'No matching care form records found.', 'resident_basic_info': 'Resident\'s Basic Information',
        'placement_date': 'Placement Date', 'closing_date': 'Closing Date', 'care_period': 'Care Period', 'ongoing': 'Ongoing',
        'assessment_items': 'Daily Assessment Items', 'signature': 'Signature', 'caregiver': 'Caregiver', 'nurse': 'Nurse',
        'hand_hygiene': '1. Hand Hygiene', 'fixed_position': '2. Fixed Position', 'unobstructed_drainage': '3. Unobstructed Drainage',
        'avoid_overfill': '4. Avoid Overfill', 'urethral_cleaning': '5. Urethral Cleaning', 'single_use_container': '6. Single Use Container',
        'yes': 'Yes', 'no': 'No', 'save_this_care_form': 'Save This Care Form', 'delete_this_care_form': 'Delete This Care Form',
        'back_to_list': 'Back to List', 'load_care_form_failed': 'Failed to load care form, please try again later.',
        'fill_form_first': 'Please select a resident and fill in the placement date first!', 'care_form_saved': 'Care form has been saved successfully!',
        'confirm_delete_care_form': 'Are you sure you want to permanently delete this care form?\nThis action cannot be undone!',
        'care_form_deleted': 'Care form has been deleted successfully!', 'index_building_warning': 'The system is building a new index to support this query. Please wait a few minutes and try again.',
        
        // --- Office System ---
        'office_system': 'Office System', 'enter_office_password': 'Please enter office password',
        'auto_temp_system': 'Automated Temperature Log System', 'auto_clockin_system': 'Automated Clock-in/out System',
        'temperature_label': 'Temperature','temperature_system': 'Temperature System', 'clockin_system': 'Clock-in/out System', 'select_month': 'Select Month',
        'upload_schedule': 'Upload Schedule', 'upload_and_generate': 'Upload Schedule & Generate Records',
        'reading_schedule_and_generating': 'Reading schedule and generating records...', 'error_select_month_first': 'Please select a month first!',
        'error_read_excel': 'Failed to read Excel file. Please check the file format.', 'export_word': 'Export Word',
        'export_excel': 'Export Excel', 'print_report': 'Print Report', 'no_report_generated': 'Please select a month and upload the corresponding Excel schedule file.',
        'temp_report_title': 'Employee Temperature Log', 'clockin_report_title': 'Employee Clock-in/out Log',
        'clock_in': 'Clock In', 'clock_out': 'Clock Out',
    }
};

function setLanguage(lang) {
    localStorage.setItem('language', lang);
    document.documentElement.lang = lang === 'en' ? 'en' : 'zh-Hant';
}

function getLanguage() {
    return localStorage.getItem('language') || 'zh-TW';
}

function getText(key, replacements = {}) {
    const lang = getLanguage();
    const langDict = translations[lang] || translations['zh-TW'];
    let text = langDict[key] || key;
    
    for (const placeholder in replacements) {
        text = text.replace(`{${placeholder}}`, replacements[placeholder]);
    }
    return text;
}

function applyTranslations() {
    const lang = getLanguage();
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const text = getText(key);
        if (el.placeholder !== undefined && el.tagName === 'INPUT') {
            el.placeholder = text;
        } else {
            el.textContent = text;
        }
    });
}


// (embedded) Apply translations immediately on load if DOM is ready
try { applyTranslations(); } catch (e) { /* ignore until DOM ready */ }

document.addEventListener('firebase-ready', () => {
    // ÈÄèÈÅéÂ∞ãÊâæ bookingForm ‰æÜÂà§Êñ∑ÊòØÂê¶Âú®È†êÁ¥ÑÈ†ÅÈù¢
    const bookingForm = document.getElementById('bookingForm');
    if (!bookingForm) return;

    // --- Êô∫ÊÖßËøîÂõûÊåâÈàïÈÇèËºØ ---
    const backButtonGeneral = document.querySelector('.btn-back-menu');
    if (backButtonGeneral) {
        const urlParams = new URLSearchParams(window.location.search);
        if (document.referrer.includes('admin.html') || urlParams.get('mode') === 'admin') {
            backButtonGeneral.href = 'admin.html?view=dashboard';
            const icon = backButtonGeneral.querySelector('i');
            backButtonGeneral.innerHTML = ''; // Ê∏ÖÁ©∫ÊåâÈàïÂÖßÂÆπ
            if(icon) backButtonGeneral.appendChild(icon); // ÊääÂúñÁ§∫Âä†ÂõûÂéª
            backButtonGeneral.append(` ${getText('back_to_dashboard')}`); // Âä†‰∏äÊñ∞ÊñáÂ≠ó
        }
    }

    // üîÑ ÊîπÁÇ∫Âæû Firestore ÁöÑ `residents` ÈõÜÂêàËºâÂÖ•‰ΩèÊ∞ëÂêçÂñÆËàáÂ∫äËôü
let residentDatabase = {};
async function loadResidents() {
    try {
        const snap = await db.collection('residents').get();
        const map = {};
        snap.forEach(doc => {
            const data = doc.data() || {};
            const name = doc.id; // ÂÅáË®≠Êñá‰ª∂IDÁÇ∫‰ΩèÊ∞ëÂßìÂêç
            const bed = data.bedNumber || '';
            if (name) map[name] = bed;
        });
        residentDatabase = map;
        // Ëã•‰ΩøÁî®ËÄÖÂ∑≤Á∂ìËº∏ÂÖ•ÂßìÂêçÔºåÂòóË©¶Âç≥ÊôÇÂ•óÁî®ÔºàÂèãÂñÑÈ´îÈ©óÔºâ
        const rn = document.getElementById('residentName');
        const bn = document.getElementById('bedNumber');
        const fb = document.getElementById('nameFeedback');
        if (rn && bn && rn.value.trim()) {
            const val = rn.value.trim();
            if (residentDatabase[val]) {
                rn.classList.remove('is-invalid');
                rn.classList.add('is-valid');
                bn.value = residentDatabase[val];
                if (fb) { fb.textContent = getText('name_validation_success'); fb.className = 'valid-feedback'; }
            }
        }
        console.log('[booking] residents loaded:', Object.keys(residentDatabase).length);
    } catch (e) {
        console.error('ËÆÄÂèñ residents Â§±ÊïóÔºö', e);
    }
}
    const adminNotice = document.getElementById('admin-mode-notice');
    const visitDateInput = document.getElementById('visitDate');
    const timeSlotsContainer = document.getElementById('time-slots');
    const bookingNotice = document.getElementById('booking-notice');
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const backButton = document.getElementById('backButton');
    const successMessage = document.getElementById('successMessage');
    const selectedTimeDisplay = document.getElementById('selected-time-display');
    const residentNameInput = document.getElementById('residentName');
    const bedNumberInput = document.getElementById('bedNumber');
    const nameFeedback = document.getElementById('nameFeedback');
    const confirmationModalElement = document.getElementById('confirmationModal');
    const confirmationModal = new bootstrap.Modal(confirmationModalElement);
    const finalSubmitButton = document.getElementById('final-submit-button');\n    // ÂÖàËºâÂÖ•‰ΩèÊ∞ëË≥áÊñô\n    loadResidents();
    
    const urlParams = new URLSearchParams(window.location.search);
    const isAdminMode = urlParams.get('mode') === 'admin';
    if (isAdminMode) {
        adminNotice.classList.remove('d-none');
    }
    
    let pendingBookingData = {};
    // Flag: booking completed => freeze UI updates
    let completed = false;
    const availableTimes = ["14:30", "15:00", "15:30", "16:00", "16:30"];
    const maxBookingsPerSlot = 4;
    let selectedDate = '';
    let selectedTime = '';
    const today = new Date().toISOString().split('T')[0];
    visitDateInput.setAttribute('min', today);
    visitDateInput.value = today;
    selectedDate = today;

    async function renderTimeSlots() {
        timeSlotsContainer.innerHTML = getText('reading_slots');
        bookingNotice.classList.add('d-none');
        const now = new Date();
        const todayString = now.toISOString().split('T')[0];
        if (selectedDate === todayString && now.getHours() >= 12 && !isAdminMode) {
            bookingNotice.textContent = getText('today_past_noon');
            bookingNotice.classList.remove('d-none');
            timeSlotsContainer.innerHTML = '';
            return;
        }
        try {
            const snapshot = await db.collection('bookings').where('date', '==', selectedDate).get();
            const bookingsForDate = {};
            snapshot.forEach(doc => {
                const booking = doc.data();
                if (!bookingsForDate[booking.time]) bookingsForDate[booking.time] = 0;
                bookingsForDate[booking.time]++;
            });
            timeSlotsContainer.innerHTML = '';
            availableTimes.forEach(time => {
                const count = bookingsForDate[time] || 0;
                const remaining = maxBookingsPerSlot - count;
                const isFull = remaining <= 0;
                let isPast = false;
                if (selectedDate === todayString) {
                    const [slotHour, slotMinute] = time.split(':').map(Number);
                    const slotTime = new Date();
                    slotTime.setHours(slotHour, slotMinute, 0, 0);
                    if (now > slotTime) isPast = true;
                }
                const button = document.createElement('button');
                button.className = `btn ${isFull||isPast?'btn-outline-secondary full':'btn-outline-primary'} time-slot`;
                button.dataset.time = time;
                button.disabled = isFull || isPast;
                if (isFull) button.textContent = `${time} (${getText('slot_full')})`;
                else if (isPast) button.textContent = `${time} (${getText('slot_past')})`;
                else button.textContent = `${time} (${getText('slot_remaining', { remaining: remaining })})`;
                timeSlotsContainer.appendChild(button);
            });
        } catch (error) {
            console.error("ËÆÄÂèñÊôÇÊÆµË≥áÊñôÂ§±Êïó:", error);
            timeSlotsContainer.innerHTML = `<div class="alert alert-danger">${getText('read_slots_failed')}</div>`;
        }
    }

    function displaySuccessMessage(bookingData) {

        document.getElementById('confirmDate').textContent = selectedDate;
        document.getElementById('confirmTime').textContent = selectedTime;
        document.getElementById('confirmResidentName').textContent = bookingData.residentName;
        document.getElementById('confirmBedNumber').textContent = bookingData.bedNumber;
        document.getElementById('confirmVisitorRelationship').textContent = bookingData.visitorRelationship;
        step1.classList.add('d-none');
        step2.classList.add('d-none');
        successMessage.classList.remove('d-none');
        // Lock UI so other events won't redraw the page
        completed = true;
    }

    visitDateInput.addEventListener('change', (e) => {
        if (completed) return;
        selectedDate = e.target.value;
        renderTimeSlots();
    });
    timeSlotsContainer.addEventListener('click', (e) => {
        if (completed) return;
        if (e.target.tagName === 'BUTTON' && !e.target.disabled) {
            selectedTime = e.target.dataset.time;
            selectedTimeDisplay.textContent = `${selectedDate} ${selectedTime}`;
            step1.classList.add('d-none');
            step2.classList.remove('d-none');
        }
    });
    backButton.addEventListener('click', () => {
        completed = false;
        step2.classList.add('d-none');
        step1.classList.remove('d-none');
        bookingForm.reset();
        bookingForm.classList.remove('was-validated');
        residentNameInput.classList.remove('is-valid', 'is-invalid');
        bedNumberInput.value = '';
    });
    residentNameInput.addEventListener('input', function() {
        const name = this.value.trim();
        if (residentDatabase[name]) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
            bedNumberInput.value = residentDatabase[name];
            if(nameFeedback) nameFeedback.textContent = getText('name_validation_success');
            if(nameFeedback) nameFeedback.className = 'valid-feedback';
        } else {
            this.classList.remove('is-valid');
            this.classList.add('is-invalid');
            bedNumberInput.value = '';
            if(nameFeedback) nameFeedback.textContent = getText('name_validation_fail');
            if(nameFeedback) nameFeedback.className = 'invalid-feedback';
        }
    });
    bookingForm.addEventListener('submit', function(e) {
        e.preventDefault();
        e.stopPropagation();
        bookingForm.classList.add('was-validated');
        if (!bookingForm.checkValidity()) { return; }
        const residentName = residentNameInput.value.trim();
        if (!residentDatabase[residentName]) {
            bookingForm.classList.remove('was-validated');
            residentNameInput.classList.add('is-invalid');
            if(nameFeedback) nameFeedback.textContent = getText('name_validation_fail');
            if(nameFeedback) nameFeedback.style.display = 'block';
            return;
        }
        pendingBookingData = {
            residentName,
            bedNumber: bedNumberInput.value,
            visitorRelationship: document.getElementById('visitorRelationship').value,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };
        document.getElementById('modal-confirm-date').textContent = selectedDate;
        document.getElementById('modal-confirm-time').textContent = selectedTime;
        document.getElementById('modal-confirm-residentName').textContent = pendingBookingData.residentName;
        document.getElementById('modal-confirm-visitorRelationship').textContent = pendingBookingData.visitorRelationship;
        confirmationModal.show();
    });
    finalSubmitButton.addEventListener('click', async function() {
        finalSubmitButton.disabled = true;
        try {
            await db.collection('bookings').add({
                date: selectedDate,
                time: selectedTime,
                ...pendingBookingData
            });
            confirmationModal.hide();
            displaySuccessMessage(pendingBookingData);
        } catch (error) {
            console.error("È†êÁ¥ÑÂÑ≤Â≠òÂ§±Êïó:", error);
            alert(getText('booking_failed'));
        } finally {
            finalSubmitButton.disabled = false;
        }
    });
    renderTimeSlots();
});



