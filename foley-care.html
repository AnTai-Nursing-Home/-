<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title data-i18n="foley_care_assessment"></title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
<link href="style.css" rel="stylesheet"/>
<link href="/favicon.ico" rel="icon" type="image/x-icon"/>
<style>
        /* 今日日期高亮 */
        .care-table tr.today-row > th,
        .care-table tr.today-row > td {
            background-color: #fff3cd !important;
        }
        .care-table tr.today-row > th { font-weight: 700; }
        @media print {
            .care-table tr.today-row > th,
            .care-table tr.today-row > td {
                background-color: #fff3cd !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    
        /* ✅ 修正：手機版簽名欄被擠到看不到（不改欄位順序） */
        .care-table {
            min-width: 1200px; /* 讓表格保持合理總寬度，改由橫向滑動呈現 */
        }
        .care-table th:last-child,
        .care-table td:last-child {
            min-width: 160px;  /* 簽名欄至少要看得到 */
            width: 160px;
            white-space: nowrap;
        }

    </style>
</head>
<body>
<div class="container my-5">
<div class="row justify-content-center">
<div class="col-lg-12">
<div class="card shadow">
<div class="card-header text-center bg-dark text-white">
<h2 data-i18n="foley_care_title"></h2>
</div>
<div class="card-body">
<div id="list-view">
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
<a class="btn btn-back-menu" href="caregiver.html?view=dashboard">
<i class="fas fa-arrow-left me-2"></i><span data-i18n="back_to_caregiver_system"></span>
</a>
<div class="d-flex align-items-center gap-2" style="max-width: 600px;">
<select class="form-select form-select-lg" id="resident-filter-select"></select>
<div class="btn-group">
<button class="btn btn-primary active" data-i18n="status_ongoing" data-status="ongoing" type="button"></button>
<button class="btn btn-secondary" data-i18n="status_closed" data-status="closed" type="button"></button>
</div>
</div><div class="d-flex align-items-center gap-2 d-none" id="closed-date-filter" style="max-width: 600px;"><span>結案單篩選：</span><input class="form-control form-control-sm" id="closed-start-date" type="date"/><span>～</span><input class="form-control form-control-sm" id="closed-end-date" type="date"/></div>
<div class="d-flex align-items-center gap-2">
<span class="text-muted small" id="login-role-status"></span>
<button class="btn btn-outline-primary d-none" id="audit-btn" type="button">
  <i class="fas fa-clipboard-check me-1"></i> 一鍵查核
</button>
<button class="btn btn-success" id="add-new-form-btn">
<i class="fas fa-plus me-2"></i><span data-i18n="add_new_form"></span>
</button>
<button class="btn btn-outline-danger btn-sm d-none" id="batch-delete-closed-btn" type="button">批次刪除結案單</button></div>
</div>
<h4 id="care-form-list-title"></h4>
<div class="list-group" id="care-form-list"></div>
</div>
<div class="d-none" id="form-view">
<div class="d-flex justify-content-between align-items-center mb-4 d-print-none">
<button class="btn btn-back-menu" id="back-to-list-btn">
<i class="fas fa-arrow-left me-2"></i><span data-i18n="back_to_list"></span>
</button>
<div class="d-flex gap-2">
<button class="btn btn-sm btn-primary" id="export-word-btn"><i class="fas fa-file-word me-1"></i> 匯出 Word</button>
<button class="btn btn-sm btn-success" id="export-excel-btn"><i class="fas fa-file-excel me-1"></i> 匯出 Excel</button>
<button class="btn btn-sm btn-info" id="print-report-btn"><i class="fas fa-print me-1"></i> 列印</button>
</div>
</div>
<fieldset class="border p-3 mb-4">
<legend class="float-none w-auto px-2" data-i18n="resident_basic_info"></legend>
<div class="row g-3">
<div class="col-md-3">
<label class="form-label" data-i18n="name" for="resident-name-select-form"></label>
<select class="form-select" id="resident-name-select-form"></select>
</div>
<div class="col-md-3">
<label class="form-label" data-i18n="chart_number"></label>
<input class="form-control" id="resident-chartNumber" type="text"/>
</div>
<div class="col-md-2"><label class="form-label" data-i18n="bed_number"></label><input class="form-control" id="resident-bedNumber" readonly="" type="text"/></div>
<div class="col-md-2"><label class="form-label" data-i18n="gender"></label><input class="form-control" id="resident-gender" readonly="" type="text"/></div>
<div class="col-md-2"><label class="form-label" data-i18n="birthday"></label><input class="form-control" id="resident-birthday" readonly="" type="text"/></div>
<div class="col-md-3"><label class="form-label" data-i18n="checkin_date"></label><input class="form-control" id="resident-checkinDate" readonly="" type="text"/></div>
<div class="col-md-3"><label class="form-label" data-i18n="placement_date" for="foley-placement-date"></label><input class="form-control" id="foley-placement-date" type="date"/></div>
<div class="col-md-3"><label class="form-label" data-i18n="closing_date" for="foley-closing-date"></label><input class="form-control" id="foley-closing-date" type="date"/></div>
<div class="col-md-3">
<label class="form-label" data-i18n="record_start_date"></label>
<input class="form-control" id="foley-record-start-date" type="date"/>
</div>
<div class="col-md-3">
<label class="form-label" data-i18n="closing_reason"></label>
<select class="form-select" id="closing-reason">
<option value="">請選擇</option>
<option value="管路拔管">管路拔管</option>
<option value="管路更換">管路更換</option>
<option value="轉出機構">轉出機構</option>
</select>
</div>
<div class="col-md-3">
<label class="form-label">建立護理師</label>
<input class="form-control" id="foley-created-by" readonly="" type="text"/>
</div>
</div>
</fieldset>
<div class="table-responsive">
<h4 class="text-center mb-3" id="table-month-title"></h4>
<table class="table table-bordered table-sm text-center align-middle care-table">
<thead>
<tr>
<th data-i18n="date" rowspan="2"></th>
<th colspan="7" data-i18n="assessment_items"></th>
<th colspan="1" data-i18n="signature"></th>
</tr>
<tr>
<th data-i18n="hand_hygiene"></th><th data-i18n="fixed_position"></th><th data-i18n="urine_bag_position"></th><th data-i18n="unobstructed_drainage"></th>
<th data-i18n="avoid_overfill"></th><th data-i18n="urethral_cleaning"></th><th data-i18n="single_use_container"></th>
<th data-i18n="caregiver"></th>
</tr>
</thead>
<tbody id="care-table-body"></tbody>
</table>
</div>
<div class="text-center mt-4 d-print-none d-flex justify-content-center gap-3">
<button class="btn btn-danger btn-lg d-none" data-i18n="delete_this_care_form" id="delete-care-form-btn"></button>
<button class="btn btn-primary btn-lg" data-i18n="save_this_care_form" id="save-care-form"></button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<footer class="site-footer d-print-none"></footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<script src="firebase-init.js"></script>
<script src="i18n.js"></script>
<script src="main.js"></script>
<script src="foley-care.js"></script>

<div class="modal fade" id="auditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">一鍵查核（未結案單）</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row g-2 align-items-end mb-3">
          <div class="col-12 col-md-3">
            <label class="form-label">查核起日</label>
            <input type="date" class="form-control" id="audit-start-date">
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label">查核迄日</label>
            <input type="date" class="form-control" id="audit-end-date">
          </div>
          <div class="col-12 col-md-6 d-flex gap-2">
            <button class="btn btn-primary" id="audit-run-btn" type="button">
              <i class="fas fa-play me-1"></i> 開始查核
            </button>
            <button class="btn btn-outline-secondary" id="audit-only-issues-btn" type="button">
              只看有缺漏
            </button>
            <div class="ms-auto text-muted small" id="audit-summary"></div>
          </div>
        </div>

        <div class="alert alert-info py-2 small">
          會掃描「未結案」的所有導尿管照護單，並檢查您選的日期區間中：照服員簽名是否有填、7 個勾選項目是否都有 Yes/No。
        </div>

        <div class="table-responsive">
          <table class="table table-sm table-bordered align-middle">
            <thead>
              <tr class="table-light">
                <th style="width: 90px;">床號</th>
                <th style="width: 180px;">住民</th>
                <th style="width: 120px;">日期</th>
                <th>缺漏</th>
                <th style="width: 140px;">快速開啟</th>
              </tr>
            </thead>
            <tbody id="audit-results-body">
              <tr><td colspan="5" class="text-muted">請先設定日期區間後按「開始查核」</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
      </div>
    </div>
  </div>
</div>
</body>
</html>
